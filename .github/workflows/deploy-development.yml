name: Deploy to development

on:
  push:
    branches: [develop, feature/*]

jobs:
  deploy:
    environment: development
    permissions:
      contents: 'read'
      id-token: 'write'
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: 'Write .env'
        uses: './.github/workflows/_write-env'
        with:
          vars: ${{ toJson(vars) }}
          secrets: ${{ toJson(secrets) }}

      - name: 'Deploy'
        uses: './.github/workflows/_deploy'
        with:
          gcp-project-id: ${{ vars.GCP_PROJECT_ID }}
          gcp-service-account: ${{ secrets.GCP_SERVICE_ACCOUNT }}
          gcp-workload-identity-provider: ${{ secrets.GCP_WORKLOAD_IDENTITY_PROVIDER }}
